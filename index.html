
<!DOCTYPE html>
<html>
<head>
  <!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-37JCGCNNVT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-37JCGCNNVT');
</script>

  <title>Boram Junctionâ€“Dagua Road Video Map</title>
  <meta charset="utf-8" />
  <style>
    body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
    #header {
      padding: 16px;
      background-color: #f4f4f4;
      border-bottom: 1px solid #ccc;
    }
    #header h1 {
      margin: 0;
      font-size: 22px;
    }
    #header p {
      margin: 4px 0 0;
      font-size: 14px;
      color: #555;
    }
    #content {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 80px);
    }
    #video {
      height: 40%;
      width: 100%;
    }
    #map {
      height: 60%;
      width: 100%;
      position: relative;
    }
    iframe { width: 100%; height: 100%; border: none; }
    #infoBox {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      z-index: 1000;
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
  <div id="header">
    <h1>Boram Junctionâ€“Dagua Road Video Map</h1>
    <p>This dashboard synchronizes video footage with the GPS-tracked route for the Boram Junctionâ€“Dagua road upgrade, showing real-time progress and travel distance.</p>
  </div>
  <div id="content">
    <div id="video">
      <iframe id="ytplayer" type="text/html"
        src="https://www.youtube.com/embed/PsWyslsSZlU?enablejsapi=1&rel=0"
        frameborder="0" allowfullscreen></iframe>
    </div>
    <div id="map"></div>
  </div>
  <div id="infoBox">
    <strong>Distance Travelled</strong><br>
    <span id="dist">0.00</span> km
  </div>

  <script>
    let map = L.map('map', {
      dragging: false,
      scrollWheelZoom: false,
      doubleClickZoom: false,
      touchZoom: false,
      boxZoom: false,
      keyboard: false,
      zoomControl: false
    });

    // Direct Esri satellite tile URL
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles Â© Esri â€” Source: Esri, Maxar, Earthstar Geographics',
      maxZoom: 19
    }).addTo(map);

    let routeData = [];
    let marker, player;

    fetch('boram_dagua_synced.geojson')
      .then(res => res.json())
      .then(data => {
        routeData = data.features;
        const latlngs = routeData.map(f => [f.geometry.coordinates[1], f.geometry.coordinates[0]]);
        const bounds = L.polyline(latlngs).getBounds();
        map.fitBounds(bounds);
        map.setMaxBounds(bounds); // lock map to bounds
        L.polyline(latlngs, { color: 'blue' }).addTo(map);
        marker = L.marker(latlngs[0]).addTo(map);
        setInterval(syncMarkerToVideo, 1000);
      });

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('ytplayer', {
        events: {
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function syncMarkerToVideo() {
      if (!player || typeof player.getCurrentTime !== 'function' || routeData.length === 0) return;
      let time = Math.floor(player.getCurrentTime());

      let match = routeData.reduce((prev, curr) => {
        return Math.abs(curr.properties.timestamp - time) < Math.abs(prev.properties.timestamp - time) ? curr : prev;
      });

      if (match && match.geometry && match.properties) {
        let [lon, lat] = match.geometry.coordinates;
        marker.setLatLng([lat, lon]);
        document.getElementById('dist').innerText = match.properties.cum_distance_km.toFixed(2);
      }
    }

    function onPlayerStateChange(event) {
      // No switching logic needed for single video
    }
  </script>
  <!-- Visitor Counter Badge -->
<div style="text-align: center; padding: 20px;">
  <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=rudoq007.github.io/Boram_jnctn_dagua&count_bg=%2379C83D&title_bg=%23555555&icon=github.svg&icon_color=%23E7E7E7&title=visits&edge_flat=false" alt="Visitor counter"/>
</div>

<!-- Contact Info -->
<div style="text-align: center; font-family: Arial, sans-serif; font-size: 14px; color: #444; padding-bottom: 20px;">
  ðŸ“§ Contact: Rua Puka â€“ <a href="mailto:rudoq.007@gmail.com">rudoq.007@gmail.com</a>
</div>

</body>
</html>
